<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Checkout ‚Äî LatteBean Coffee</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --brand:#1e88e5;            /* original accent */
      --brand-subtle:#1e86e3;     /* ~1‚Äì2% hue shift for subtle mode */
      --bg:#f5f7fb;
      --card:#ffffff;
      --ink:#213547;
      --muted:#6b7280;
      --ok:#2e7d32;
      --warn:#f59e0b;
      --danger:#dc2626;
      --line:#e5e7eb;
    }
    *{box-sizing:border-box}
    body{
      margin:0;background:var(--bg);
      font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial;
      color:var(--ink);
    }
    .wrap{max-width:880px;margin:40px auto;padding:0 16px;}
    .header{
      display:flex;align-items:center;gap:12px;
      color:#0f172a;margin-bottom:16px;
    }
    .lock{font-size:18px}
    .domain{
      padding:8px 10px;border-radius:8px;border:1px solid var(--line);
      background:#fff;font-weight:600;letter-spacing:0.2px;
    }
    .grid{
      display:grid;grid-template-columns:1.2fr 1fr;gap:18px;
    }
    .card{
      background:var(--card);border:1px solid var(--line);border-radius:12px;
      box-shadow:0 4px 18px rgba(0,0,0,.05);
    }
    .card .hd{
      padding:14px 16px;border-bottom:1px solid var(--line);
      display:flex;align-items:center;justify-content:space-between;
    }
    .merchant{font-weight:800}
    .logos{display:flex;gap:8px;opacity:.9}
    .body{padding:16px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input{
      width:100%;padding:10px 12px;border:1px solid #dfe3ea;border-radius:8px;
      outline:none;transition:border-color .2s, box-shadow .2s;
      background:#fff;
    }
    input:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(30,136,229,.12)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .btn{
      display:inline-block;width:100%;margin-top:12px;padding:12px 14px;border:0;
      color:#fff;font-weight:800;border-radius:10px;cursor:pointer;
      background:linear-gradient(180deg,var(--brand),#1565c0);
      box-shadow:0 6px 16px rgba(21,101,192,.25);
    }
    .help{margin-top:10px;color:var(--muted);font-size:12px}
    .aside{
      background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;
      box-shadow:0 4px 18px rgba(0,0,0,.05);
      display:flex;flex-direction:column;gap:12px;
      position:relative;
    }
    .seal{
      display:flex;align-items:center;gap:8px;padding:10px;border:1px dashed #d7dde7;border-radius:10px;
      background:#fafbff;
    }
    .controls{
      margin-top:12px;display:flex;gap:8px;flex-wrap:wrap
    }
    .small{font-size:11px;color:var(--muted)}
    .badge{
      position:absolute;top:10px;right:10px;font-size:11px;font-weight:700;
      padding:4px 8px;border-radius:999px;background:#eef2ff;color:#3730a3;border:1px solid #c7d2fe;
    }
    /* tiny SVG logos */
    .logo{display:inline-block;width:34px;height:22px;border-radius:4px;border:1px solid #d1d5db}
    .visa{background:linear-gradient(180deg,#0433A3,#0a48e3)}
    .mc{background:radial-gradient(circle at 40% 50%,#ff5f00 0 38%,transparent 39%),radial-gradient(circle at 60% 50%,#eb001b 0 38%,transparent 39%),#f79e1b}
    .amex{background:linear-gradient(180deg,#0b6fc2,#0aa1e3)}
    /* ‚Äúattack‚Äù visual tweaks we toggle via JS */
    .subtle .btn{background:linear-gradient(180deg,var(--brand-subtle),#155fba)}
    .subtle .domain{letter-spacing:0.28px}
    .subtle .logo.visa{transform:translateX(1px);opacity:.96}
    .medium .domain{border-color:#facc15;background:#fffbea}
    .medium .lock{color:#f59e0b}
    .medium .btn{background:linear-gradient(180deg,#ff7a59,#e9412f)}
    .high .domain{border-color:#fca5a5;background:#fff1f2;color:#7f1d1d}
    .high .lock{color:#dc2626}
    .high .btn{background:linear-gradient(180deg,#e11d48,#9f1239)}
    .fake-note{font-size:12px;color:#7c3aed;font-weight:700}
    @media (max-width:860px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <span class="lock">üîí</span>
      <div id="domain" class="domain">https://pay.stripe.com/lattebean-checkout</div>
    </div>

    <div class="grid">
      <!-- Payment card -->
      <section id="payCard" class="card" aria-label="Payment form">
        <div class="hd">
          <div class="merchant">LatteBean Coffee</div>
          <div class="logos">
            <span class="logo visa" title="Visa"></span>
            <span class="logo mc" title="Mastercard"></span>
            <span class="logo amex" title="AmEx"></span>
          </div>
        </div>
        <div class="body">
          <div style="margin-bottom:10px;">
            <label for="name">Name on card</label>
            <input id="name" placeholder="Alex Doe" autocomplete="cc-name"/>
          </div>
          <div style="margin-bottom:10px;">
            <label for="number">Card number</label>
            <input id="number" inputmode="numeric" placeholder="4242 4242 4242 4242" autocomplete="cc-number"/>
          </div>
          <div class="row" style="margin-bottom:10px;">
            <div>
              <label for="exp">Expiry</label>
              <input id="exp" inputmode="numeric" placeholder="MM / YY" autocomplete="cc-exp"/>
            </div>
            <div>
              <label for="cvc">CVC</label>
              <input id="cvc" inputmode="numeric" placeholder="CVC" autocomplete="cc-csc"/>
            </div>
          </div>
          <div style="margin-bottom:10px;">
            <label for="zip">ZIP / Postal code</label>
            <input id="zip" inputmode="numeric" placeholder="10001" autocomplete="postal-code"/>
          </div>
          <button id="payBtn" class="btn">Pay $24.00</button>
          <div id="hint" class="help">Your payment is processed securely by Stripe.</div>
        </div>
      </section>

      <!-- Sidebar / trust / controls -->
      <aside id="aside" class="aside">
        <div class="badge">DEMO</div>
        <div class="seal">
          ‚úÖ <div>
            <div style="font-weight:800">Secure Checkout</div>
            <div class="small">TLS 1.3 ‚Ä¢ HSTS enabled</div>
          </div>
        </div>
        <div class="seal">
          üõ°Ô∏è <div>
            <div style="font-weight:800">PCI-DSS Level 1</div>
            <div class="small">Audited yearly</div>
          </div>
        </div>

        <div class="controls">
          <button type="button" id="btnSubtle">Simulate SUBTLE</button>
          <button type="button" id="btnMedium">Simulate MEDIUM</button>
          <button type="button" id="btnHigh">Simulate HIGH</button>
          <button type="button" id="btnReset">Reset</button>
        </div>
        <div class="small">Tip: switch to another tab and come back to auto-trigger (when <code>?auto=1</code>).</div>
      </aside>
    </div>
  </div>

  <script>
    // --- query flags ---
    const qs = new URLSearchParams(location.search);
    const modeParam = (qs.get('mode') || 'subtle').toLowerCase(); // subtle|medium|high
    const auto = qs.get('auto') !== '0'; // default true
  
    // --- helpers & state ---
    const $ = (sel) => document.querySelector(sel);
    const root = document.documentElement;
  
    let attacked = false;
    let armedLevel = qs.has('mode') ? modeParam : null; // pre-arm via ?mode=...
    
    // ---------- baseline UI ----------
    function resetUI(){
      attacked = false;
      root.classList.remove('subtle','medium','high');
      $('#domain').textContent = 'https://pay.stripe.com/lattebean-checkout';
      $('.merchant').textContent = 'LatteBean Coffee';
      $('#payBtn').textContent = 'Pay $24.00';
      $('#payBtn').style.transform = 'translateY(0)';
      $('#hint').innerHTML = 'Your payment is processed securely by Stripe.';
      $('#aside').style.borderColor = 'var(--line)';
    }
  
    // ---------- attack variants ----------
    function attackSubtle(){
      root.classList.add('subtle');
      $('#domain').textContent = 'https://pay.stripe.com/lattebean-checkout';
      $('#hint').innerHTML = 'Your payment is processed <b>securely</b> by Stripe.';
      $('#payBtn').style.transform = 'translateY(1px)'; // tiny measurable diff
    }
    function attackMedium(){
      root.classList.add('medium');
      $('#domain').textContent = 'https://pay.stripee.com/lattebean-checkout';
      $('#hint').innerHTML = 'Verified ‚Ä¢ 256-bit encryption';
      $('#aside').style.borderColor = '#facc15';
      $('#payBtn').textContent = 'Verify & Pay $24.00';
    }
    function attackHigh(){
      root.classList.add('high');
      $('.merchant').textContent = 'LatteBean Secure Portal';
      $('#domain').textContent = 'https://stripe-secure-pay.com/lattebean';
      $('#payBtn').textContent = 'Continue';
      $('#hint').innerHTML = '<span class="fake-note">‚ö† Additional verification required</span>';
    }
  
    function runAttack(level){
      if (attacked) return;
      attacked = true;
      if (level === 'high') attackHigh();
      else if (level === 'medium') attackMedium();
      else attackSubtle();
    }
  
    // ---------- arming (no change yet) ----------
    function arm(level){
      armedLevel = level;
      attacked = false;
      $('#hint').innerHTML = `Armed: will simulate <b>${level.toUpperCase()}</b> after you leave this tab.`;
    }
  
    // Buttons now ARM only (no immediate change)
    $('#btnSubtle').addEventListener('click', () => { resetUI(); arm('subtle'); });
    $('#btnMedium').addEventListener('click', () => { resetUI(); arm('medium'); });
    $('#btnHigh').addEventListener('click',  () => { resetUI(); arm('high');   });
    $('#btnReset').addEventListener('click', () => { resetUI(); armedLevel = null; });
  
    // ---------- trigger WHILE HIDDEN (before you navigate back) ----------
    function triggerIfArmed() {
      if (attacked) return;
      const level = armedLevel || (auto ? modeParam : null);
      if (!level) return;
  
      // Execute shortly after backgrounding; helps align with capture cadence
      const start = () => runAttack(level);
      if (typeof requestIdleCallback === 'function') {
        requestIdleCallback(start, { timeout: 1200 });
      } else {
        setTimeout(start, 250);
      }
    }
  
    // Fire as soon as the tab goes to background
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) triggerIfArmed();
    });
    // Extra hook (some environments throttle visibility events)
    window.addEventListener('blur', triggerIfArmed);
  
    // ---------- boot ----------
    resetUI();
    if (armedLevel) {
      $('#hint').innerHTML =
        `Armed from URL: will simulate <b>${armedLevel.toUpperCase()}</b> after you leave this tab.`;
    }
  </script>
  
</body>
</html>
